---
title: "Prediction Model"
author: "Phong, Marvin, Isabel"
date: "2025-03-08"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Objectives

Machine learning techniques will be applied to forecast support levels <https://github.com/phongtdng/Coursework---Text-Mining>based on observed trends.

Ensure the modelâ€™s accuracy and reliability, rigorous calibration and validation will be necessary.

# Library

```{r}
library(tidyverse)
library(ggplot2)
library(caret)
```

# Data

```{r}
data <- read_rds("df_rf.rds") %>% 
  mutate(isocntry = as.character(isocntry),
         qc19 = as.factor(qc19))
```

## Training Data Split

```{r}
trainIndex <- createDataPartition(data$qc19, p=0.7,
                             list = FALSE,
                             times = 1)
train <- data[trainIndex,]
test <- data[-trainIndex,]
```

## Data Imbalance Check

```{r}
train %>% 
  mutate(isocntry = ifelse(isocntry %in% c("DE-W", "DE-E"), "DE", isocntry)) %>% 
  group_by(qc19) %>% 
  summarise(count = n()) %>% 
  mutate(percent = count/sum(count)) %>% 
  arrange(desc(percent)) %>% 
  ungroup() %>% 
  ggplot(aes(x= qc19, y=percent, label=count)) +
  geom_col() +
  geom_text(vjust = -0.3)
```

There is a clear imbalance within the answers to qc19. We, therefore, will balance the data set in order to improve the performance of the prediction model.

## Undersampling

```{r}
under <- downSample(train, train$qc19)

under %>% 
  mutate(isocntry = ifelse(isocntry %in% c("DE-W", "DE-E"), "DE", isocntry)) %>% 
  group_by(qc19) %>% 
  summarise(count = n()) %>% 
  mutate(percent = count/sum(count)) %>% 
  arrange(desc(percent)) %>% 
  ungroup() %>% 
  ggplot(aes(x= qc19, y=percent, label=count)) +
  geom_col() +
  geom_text(vjust = -0.3)
```

## Oversampling

```{r}
over <- upSample(train, train$qc19)

over %>% 
  mutate(isocntry = ifelse(isocntry %in% c("DE-W", "DE-E"), "DE", isocntry)) %>% 
  group_by(qc19) %>% 
  summarise(count = n()) %>% 
  mutate(percent = count/sum(count)) %>% 
  arrange(desc(percent)) %>% 
  ungroup() %>% 
  ggplot(aes(x= qc19, y=percent, label=count)) +
  geom_col() +
  geom_text(vjust = -0.3)
```

## Synthetic Data

# Select Modeling Method

# Train Model

# Performance Evaluation
